<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notes</title>
  <style>
    :root{
      --primary:#2563eb; --primary-weak:rgba(37,99,235,.12);
      --text:#111827; --muted:#6b7280;
      --bg:#fff; --bg-muted:#f8fafc; --page:#F3F4F6;
      --border:#e5e7eb; --error:#EF4444;
      --shadow-sm:0 1px 2px rgba(0,0,0,.05);
      --shadow-md:0 4px 10px rgba(0,0,0,.10);
      --radius:10px; --radius-sm:8px;
    }
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{ 
      margin:0; font:13px/1.5 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      color:#374151; background:var(--page); display:flex; flex-direction:column;
    }

    .container{ display:flex; height:100vh; width:100%; }
    .content-wrapper{ flex:1; display:flex; flex-direction:column; padding:12px; overflow:hidden; }
    .notes-wrapper{
      display:flex; flex-direction:column; min-height:0; height:100%;
      background:var(--bg-muted); border-radius:12px; overflow:hidden;
      border:1px solid var(--border); box-shadow:var(--shadow-sm);
    }

    .header{ flex:0 0 auto; padding:10px 12px; background:var(--bg-muted); border-bottom:1px solid var(--border); }
    .header-top{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .header h2{ margin:0; font-size:16px; font-weight:600; color:var(--text); }
    .pill{ display:inline-block; padding:2px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; font-size:12px; border:1px solid #c7d2fe; }

    .input-section{ flex:0 0 auto; padding:10px 12px; background:var(--bg-muted); border-bottom:1px solid var(--border); }
    .search-container{ width:100%; max-width:300px; margin-bottom:10px; }

    .search-input,
    .note-input{
      width:100%; background:var(--bg); border:1px solid var(--border);
      border-radius:var(--radius); padding:8px 10px; font:inherit; outline:none;
      box-shadow:var(--shadow-sm); transition:border-color .15s ease, box-shadow .15s ease;
    }
    .search-input::placeholder{ color:#9ca3af; }
    .search-input:focus,.note-input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px var(--primary-weak); }
    .note-input{ padding:10px 72px 10px 10px; min-height:56px; max-height:120px; resize:vertical; }

    .add-note-wrapper{ position:relative; }
    .add-note-btn{
      position:absolute; right:4px; bottom:4px; padding:6px 10px;
      background:var(--bg); border:1px solid var(--border); border-radius:6px; font-size:13px; cursor:pointer;
      transition:background-color .15s ease, border-color .15s ease, transform .1s ease; box-shadow:var(--shadow-sm);
    }
    .add-note-btn:hover{ background:#f9fafb; border-color:var(--primary); }
    .add-note-btn:active{ transform:translateY(1px); }
    .add-note-btn:disabled{ opacity:.5; cursor:not-allowed; }

    .image-preview-container-input{
      position:relative; margin-top:8px; border-radius:6px; overflow:hidden; border:1px dashed var(--border); background:var(--bg);
      padding:8px;
    }
    .image-preview-input{ width:100%; display:block; max-height:280px; object-fit:contain; }
    .remove-image-btn{
      position:absolute; top:8px; right:8px; width:22px; height:22px;
      background:rgba(255,255,255,.95); border:none; border-radius:50%; color:var(--error);
      font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; box-shadow:var(--shadow-sm);
      z-index:10;
    }

    /* ÂõæÁâáÈ¢ÑËßàÁΩëÊ†ºÊ†∑Âºè */
    .image-preview-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
      gap:8px;
      max-height:300px;
      overflow-y:auto;
    }
    .image-preview-grid img{
      width:100%;
      height:100px;
      object-fit:cover;
      border-radius:4px;
      border:1px solid var(--border);
    }

    /* Á¨îËÆ∞Âç°ÁâáÂõæÁâáÁΩëÊ†ºÊ†∑Âºè */
    .note-image-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
      gap:6px;
      margin-top:6px;
    }
    .note-image-grid img{
      width:100%;
      height:100px;
      object-fit:cover;
      border-radius:4px;
    }

    .notes-list{
      flex:1 1 auto; min-height:0; overflow:auto;
      padding:12px; display:flex; flex-direction:column; gap:10px; background:#f3f4f6;
    }

    .note-card{
      padding:10px; background:var(--bg); border:1px solid var(--border);
      border-radius:8px; transition:box-shadow .15s ease, transform .15s ease;
    }
    .note-card:hover{ box-shadow:var(--shadow-md); transform:translateY(-1px); }
    .menu-open .note-card:hover{ box-shadow:none; transform:none; }

    .note-card.archived{ background:#f9fafb; }
    .archived-text{ color:#d1d5db; }

    .note-content{ margin-bottom:6px; word-break:break-word; line-height:1.4; }
    .note-image{ max-width:100%; height:auto; border-radius:4px; cursor:pointer; transition:opacity .15s ease; }
    .note-image:hover{ opacity:.9; }
    .note-header { position: relative; display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
    
    .note-time{ font-size:10px; color:#9ca3af; }
    
    .note-source { display: flex; align-items: center; gap: 4px; font-size: 10px; color: #6b7280; background: #f3f4f6; padding: 2px 6px; border-radius: 4px; line-height: 1.4; }
    
    .source-favicon { width: 12px; height: 12px; margin-right: 4px; object-fit: contain; }
    
    .source-domain, .source-title { color: #6b7280; text-decoration: none; }
    
    .source-domain:hover, .source-title:hover { text-decoration: underline; color: #3b82f6; }
    
    .source-external { margin-left: 2px; font-size: 11px; opacity: 0.7; }
    
    .source-copy-btn { background: transparent; border: none; cursor: pointer; padding: 0 2px; margin-left: 4px; font-size: 10px; opacity: 0.7; transition: opacity 0.2s; }
    
    .source-copy-btn:hover { opacity: 1; }
    
    .note-tag{ 
      background:transparent; 
      color:#3B82F6; 
      padding:2px 6px; 
      border-radius:4px; 
      font-weight:500; 
      cursor:pointer; 
      text-decoration:none; 
      margin:0 2px;
      font-size:12px; 
      transition: background-color 0.2s ease;
    }
    .note-tag:hover{
      background:var(--primary-weak);
    }

    .card-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:6px;
    }
    
    .tags-container{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }
    
    .note-input-wrapper {
      position: relative;
    }

    .tag-btn{
      display: none;
    }

    .add-note-btn{
      position:absolute; right:4px; bottom:4px; padding:6px 10px;
      background:var(--bg); border:1px solid var(--border); border-radius:6px; font-size:13px; cursor:pointer;
      transition:background-color .15s ease, border-color .15s ease, transform .1s ease; box-shadow:var(--shadow-sm);
      z-index: 5;
    }

    .more-menu-container{ position:relative; display:flex; justify-content:flex-end; }

    /* Ê†áÁ≠æËèúÂçïÊ†∑Âºè */
    .tag-menu{
      position:absolute;
      top:100%;
      left:0;
      width:280px;
      max-height:300px;
      background:var(--bg);
      border:1px solid var(--border);
      border-radius:8px;
      box-shadow:var(--shadow-md);
      z-index:100;
      overflow:hidden;
      display:none;
    }
    
    .tag-menu-header{
      padding:8px 12px;
      border-bottom:1px solid var(--border);
      background:var(--bg-muted);
    }
    
    .tag-menu-search{
      width:100%;
      padding:6px 8px;
      border:1px solid var(--border);
      border-radius:4px;
      font-size:12px;
    }
    
    .tag-menu-list{
      max-height:250px;
      overflow-y:auto;
    }
    
    .tag-menu-item{
      padding:8px 12px;
      cursor:pointer;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:8px;
      transition: background-color 0.2s ease;
    }
    
    .tag-menu-item:hover{
      background:var(--bg-muted);
    }
    
    .tag-menu-item-tag{
      background:#3B82F6;
      color:#fff;
      padding:2px 6px;
      border-radius:4px;
      font-size:11px;
    }
    .more-btn{
      width:22px; height:22px; padding:0; background:transparent; border:1px solid var(--border);
      border-radius:4px; font-size:14px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; opacity:0;
      transition:opacity .15s ease, background-color .15s ease, border-color .15s ease;
    }
    .note-card:hover .more-btn{ opacity:1; }
    .more-btn:hover{ background:#f9fafb; border-color:var(--primary); }
    .drop-menu{
      position:absolute; top:100%; right:0; margin-top:4px; background:var(--bg);
      border:1px solid var(--border); border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,.15); min-width:110px; z-index:100; overflow:hidden;
    }
    .menu-option{ padding:8px 10px; cursor:pointer; font-size:14px; }
    .menu-option:hover{ background:#f9fafb; }
    .menu-option.delete{ color:var(--error); }

    .empty-state{ text-align:center; padding:28px 16px; color:var(--muted); font-size:13px; }

    .fullscreen-preview{ position:fixed; inset:0; background:rgba(0,0,0,.9); display:flex; align-items:center; justify-content:center; z-index:1000; cursor:pointer; }
    .fullscreen-image{ max-width:90%; max-height:90vh; object-fit:contain; }

    .rail{
      display:flex; flex-direction:column; gap:4px; padding:8px 4px;
      background:#fafafa; border-radius:12px; margin:16px 8px 16px 0; border:1px solid var(--border);
    }
    .railbtn{
      width:40px; height:40px; border:none; border-radius:8px; background:transparent;
      font-size:20px; cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:background-color .15s ease, transform .1s ease;
    }
    .railbtn:hover{ background:#f0f0f0; }
    .railbtn:active{ transform:translateY(1px); }
    .railbtn.active{ background:#e3f2fd; color:#1976d2; }

    *{ scrollbar-width:thin; scrollbar-color:#CBD5E1 transparent; }
    *::-webkit-scrollbar{ width:8px; height:8px; }
    *::-webkit-scrollbar-thumb{ background:#CBD5E1; border-radius:8px; }
    *::-webkit-scrollbar-thumb:hover{ background:#94A3B8; }
    *::-webkit-scrollbar-track{ background:transparent; }
  </style>
</head>
<body>
  <div class="container">
    <div class="content-wrapper">
      <div class="notes-wrapper">
        <div class="header">
          <div class="header-top">
            <h2>Notes</h2>
            <span id="badge" class="pill">Á©∫Èó≤</span>
          </div>
        </div>

        <div class="input-section">
          <div class="search-container">
            <input type="text" id="search-input" class="search-input" placeholder="üîç ÊêúÁ¥¢"/>
          </div>

          <div class="note-input-wrapper">
            <div class="add-note-wrapper">
              <textarea id="note-input" class="note-input" placeholder="ËÆ∞ÁÇπÂï•‚Ä¶" rows="1"></textarea>
              <button id="tag-btn" class="tag-btn" title="Ê∑ªÂä†Ê†áÁ≠æ">#</button>
              <button id="add-note-btn" class="add-note-btn" style="display:none">Ê∑ªÂä†</button>
            </div>
            
            <!-- Ê†áÁ≠æËèúÂçï -->
            <div id="tag-menu" class="tag-menu">
              <div class="tag-menu-header">
                <input type="text" id="tag-menu-search" class="tag-menu-search" placeholder="ÊêúÁ¥¢Ê†áÁ≠æ..."/>
              </div>
              <div id="tag-menu-list" class="tag-menu-list">
                <!-- Ê†áÁ≠æÂàóË°®Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
              </div>
            </div>

            <div id="image-preview-container" class="image-preview-container-input" style="display:none;">
              <!-- ÂõæÁâáÈ¢ÑËßàÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
          </div>
        </div>

        <div id="notes-container" class="notes-list"></div>

        <div id="empty-state" class="empty-state" style="display:none;">
          Êó†ÂÜÖÂÆπ„ÄÇËæìÂÖ•ÊàñÁ≤òË¥¥ÂõæÁâáÂç≥ÂèØ„ÄÇ
        </div>
      </div>
    </div>

    <nav class="rail" aria-label="Èù¢ÊùøÂàáÊç¢">
      <button class="railbtn" data-target="pha-panel" title="PHA" aria-label="PHA">üëÅÔ∏è</button>
      <button class="railbtn" data-target="rocket-panel" title="Rocket" aria-label="Rocket">üöÄ</button>
      <button class="railbtn active" data-target="notes-panel" title="Á¨îËÆ∞" aria-label="Á¨îËÆ∞">üìù</button>
      <button class="railbtn" data-target="settings-panel" title="ËÆæÁΩÆ" aria-label="ËÆæÁΩÆ">‚öôÔ∏è</button>
    </nav>
  </div>

  <div id="fullscreen-preview" class="fullscreen-preview" style="display:none;">
    <img id="fullscreen-image" class="fullscreen-image" src="" alt="È¢ÑËßà"/>
  </div>

  <script type="module" src="../persist-init.js"></script>
  <script src="panel.js"></script>
  <script src="../../rail.js" type="module"></script>
</body>
</html>
