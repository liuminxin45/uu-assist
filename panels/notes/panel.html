<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notes</title>
  <script src="../../shared/theme.js" defer></script>
  <script src="../../shared/dropdown-menu.js" defer></script>
  <link rel="stylesheet" href="../../shared/styles.css">
  <style>
    /* è®¾è®¡ç³»ç»Ÿï¼šCSSå˜é‡é‡æ„ */
    :root {
      /* ä¸»é¢˜é¢œè‰² */
      --primary: #3b82f6;       /* ä¸»è‰²ï¼šè“è‰² */
      --primary-hover: #2563eb; /* ä¸»è‰²æ‚¬æµ® */
      --primary-active: #1d4ed8; /* ä¸»è‰²æ¿€æ´» */
      --primary-light: #dbeafe; /* ä¸»è‰²æµ…è‰² */
      --primary-weak: rgba(59, 130, 246, 0.12); /* ä¸»è‰²å¼±è‰² */
      
      /* æ–‡æœ¬é¢œè‰² */
      --text-primary: #111827;  /* ä¸»è¦æ–‡æœ¬ */
      --text-secondary: #374151; /* æ¬¡è¦æ–‡æœ¬ */
      --text-muted: #6b7280;    /* -mutedæ–‡æœ¬ */
      --text-disabled: #9ca3af; /* ç¦ç”¨æ–‡æœ¬ */
      
      /* èƒŒæ™¯é¢œè‰² */
      --bg-primary: #ffffff;    /* ä¸»è¦èƒŒæ™¯ */
      --bg-secondary: #f9fafb;  /* æ¬¡è¦èƒŒæ™¯ */
      --bg-tertiary: #f3f4f6;   /* ç¬¬ä¸‰çº§èƒŒæ™¯ */
      --bg-muted: #f8fafc;      /* -mutedèƒŒæ™¯ */
      --bg-overlay: rgba(255, 255, 255, 0.8); /* è¦†ç›–å±‚èƒŒæ™¯ */
      
      /* è¾¹æ¡†é¢œè‰² */
      --border-light: #e5e7eb;  /* æµ…è‰²è¾¹æ¡† */
      --border-default: #d1d5db; /* é»˜è®¤è¾¹æ¡† */
      --border-dark: #9ca3af;   /* æ·±è‰²è¾¹æ¡† */
      
      /* çŠ¶æ€é¢œè‰² */
      --success: #10b981;       /* æˆåŠŸè‰² */
      --warning: #f59e0b;       /* è­¦å‘Šè‰² */
      --error: #ef4444;         /* é”™è¯¯è‰² */
      
      /* é˜´å½± */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-focus: 0 0 0 3px var(--primary-weak);
      
      /* åœ†è§’ */
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 10px;
      --radius-xl: 12px;
      --radius-full: 9999px;
      
      /* é—´è· */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 12px;
      --space-lg: 16px;
      --space-xl: 20px;
      --space-2xl: 24px;
      
      /* è¿‡æ¸¡åŠ¨ç”» */
      --transition-fast: 100ms ease;
      --transition-normal: 150ms ease;
      --transition-slow: 200ms ease;
      
      /* ä¾§è¾¹æ æŒ‰é’®å°ºå¯¸ */
      --rail-btn: 48px;
      
      /* ä¸»é¢˜æ§åˆ¶å˜é‡ */
      --theme: light;
      --theme-dark: 0;
      --theme-light: 1;
    }
    
    /* æ·±è‰²æ¨¡å¼æ”¯æŒ */
    @media (prefers-color-scheme: dark) {
      :root {
        /* ä¸»é¢˜é¢œè‰² - æ·±è‰²æ¨¡å¼ */
        --primary: #3b82f6;
        --primary-hover: #60a5fa;
        --primary-active: #93c5fd;
        --primary-light: #1e3a8a;
        --primary-weak: rgba(59, 130, 246, 0.15);
        
        /* æ–‡æœ¬é¢œè‰² - æ·±è‰²æ¨¡å¼ */
        --text-primary: #f9fafb;
        --text-secondary: #f3f4f6;
        --text-muted: #9ca3af;
        --text-disabled: #6b7280;
        
        /* èƒŒæ™¯é¢œè‰² - æ·±è‰²æ¨¡å¼ */
        --bg-primary: #111827;
        --bg-secondary: #1f2937;
        --bg-tertiary: #374151;
        --bg-muted: #0f172a;
        --bg-overlay: rgba(15, 23, 42, 0.8);
        
        /* è¾¹æ¡†é¢œè‰² - æ·±è‰²æ¨¡å¼ */
        --border-light: #374151;
        --border-default: #4b5563;
        --border-dark: #6b7280;
        
        /* é˜´å½± - æ·±è‰²æ¨¡å¼ */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.2);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        
        /* ä¸»é¢˜æ§åˆ¶å˜é‡ */
        --theme: dark;
        --theme-dark: 1;
        --theme-light: 0;
      }
    }
    
    /* åŸºç¡€æ ·å¼é‡ç½® */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    *,*::before,*::after{ box-sizing:border-box; }
    html,body{ height:100%; }
    body {
      margin: 0;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--bg-secondary);
      display: flex;
      flex-direction: column;
    }
    
    }
    
    .content-wrapper{
      height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--bg-secondary);
      /* ç§»é™¤ overflow: hidden ä»¥å…è®¸å†…éƒ¨æ»šåŠ¨ */
    }

    /* å¤´éƒ¨æ ·å¼ */
    .header {
      flex: 0 0 auto;
      padding: var(--space-md) var(--space-lg);
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
      z-index: 10;
    }
    
    .header-top {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: var(--space-md);
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-left: auto;
    }
    
    .header h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }
    
    /* ä¸‹æ‹‰èœå•æ ·å¼ */
    .dropdown {
      position: relative;
      display: inline-block;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 640px) {
      .dropdown-content {
        min-width: 100px;
        right: auto;
        left: 50%;
        transform: translateX(-50%);
      }
    }
    
    .dropdown-btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: var(--space-sm) var(--space-md);
  background: transparent;
  border: none;
  border-radius: var(--radius-md);
  cursor: pointer;
  font-size: 14px;
  color: var(--text-primary);
  transition: all var(--transition-normal);
  box-shadow: none;
}

.dropdown-btn:hover {
  background: var(--bg-secondary);
  box-shadow: var(--shadow-md);
}
    
    .dropdown-arrow {
      font-size: 10px;
      transition: transform var(--transition-fast);
    }
    
    .dropdown.active .dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .dropdown-content {
      position: absolute;
      top: 100%;
      right: 0;
      min-width: 120px;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      display: none;
      padding: var(--space-xs) 0;
      margin-top: var(--space-xs);
    }
    
    .dropdown.active .dropdown-content {
      display: block;
    }
    
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      color: var(--text-secondary);
      text-decoration: none;
      cursor: pointer;
      transition: background-color var(--transition-fast);
      font-size: 13px;
    }
    
    .dropdown-item:hover {
      background-color: var(--bg-secondary);
      color: var(--primary);
    }
    
    .dropdown-item.active {
      background-color: var(--primary-weak);
      color: var(--primary);
      font-weight: 500;
    }
    
    .pill{
      display:inline-block;
      padding:3px 10px;
      border-radius:9999px;
      background-color:var(--primary-weak);
      color:var(--primary);
      font-size:12px;
      font-weight:500;
      border:1px solid var(--primary-weak);
    }
    
    /* ä¸»å†…å®¹åŒºåŸŸ */
    .inner-pad {
      flex: 1 1 auto;
      min-height: 0;
      overflow-y: auto;
      padding: var(--space-lg);
      scrollbar-width: thin;
      scrollbar-color: var(--border-dark) transparent;
    }
    /* Notesé¡µé¢ç‰¹å®šæ ·å¼ */
    .input-section{
      flex: 0 0 auto;
      padding: var(--space-md) var(--space-lg);
      border-bottom: 1px solid var(--border-light);
      background: var(--bg-primary);
    }
    
    .search-container{ width:100%; max-width:300px; margin-bottom:10px; }
    
    .search-header {
      display: flex;
      align-items: center;
      gap: 4px;
      position: relative;
    }
    
    .search-button {
      width: 32px;
      height: 32px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
      position: relative;
    }
    
    .search-button:hover {
      background: var(--bg);
      border-color: var(--primary);
    }
    
    /* æœç´¢æŒ‰é’®æ¿€æ´»çŠ¶æ€æ ·å¼ï¼ˆcheckedæ ·å¼ï¼‰ */
    .search-button.active {
      background: var(--primary-weak);
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }
    
    /* æœç´¢è¾“å…¥æ¡†çš„æ˜¾ç¤º/éšè—å·²é€šè¿‡JavaScriptæ§åˆ¶ */
    
    .trash-button {
      width: 32px;
      height: 32px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
    }
    
    .trash-button:hover {
      background: var(--bg);
      border-color: var(--primary);
    }
    
    /* å›æ”¶ç«™æŒ‰é’®æ¿€æ´»çŠ¶æ€æ ·å¼ */
    .trash-button.active {
      background: #fef2f2;
      border-color: #fecaca;
      color: #dc2626;
      box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
    }

    /* AIæŒ‰é’®æ ·å¼ */
    .ai-button {
      width: 32px;
      height: 32px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
    }
    
    .ai-button:hover {
      background: var(--bg);
      border-color: var(--primary);
    }
    
    .ai-button.active {
      background: #e6f7ff;
      border-color: #40a9ff;
      color: #096dd9;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    
    /* AIè¾“å…¥å®¹å™¨æ ·å¼ */
    .ai-input-container {
      margin-top: 10px;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
    }
    
    .ai-tag-selection {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .ai-tag-selection label,
    .ai-prompt-input-wrapper label {
      font-size: 12px;
      color: var(--text);
      font-weight: 500;
      min-width: 70px;
    }
    
    .ai-tag-input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 8px 10px;
      font: inherit;
      outline: none;
      box-shadow: var(--shadow-sm);
      transition: border-color .15s ease;
      color: var(--text);
    }
    
    .ai-tag-input:focus {
      border-color: var(--primary);
    }
    
    .ai-prompt-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .ai-prompt-input {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 8px 10px;
      font: inherit;
      outline: none;
      box-shadow: var(--shadow-sm);
      transition: border-color .15s ease;
      color: var(--text);
      resize: vertical;
    }
    
    .ai-prompt-input:focus {
      border-color: var(--primary);
    }
    
    .ai-submit-btn {
      align-self: flex-end;
      padding: 6px 12px;
      background: var(--primary);
      border: 1px solid var(--primary);
      border-radius: 6px;
      color: white;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }
    
    .ai-submit-btn:hover {
      background: #1d4ed8;
    }
    
    /* å›æ”¶ç«™ç¬”è®°å¡ç‰‡æ ·å¼ */
    .note-card.trash-note {      background: #fef2f2;      border-color: #fecaca;      opacity: 0.9;      transition: opacity 0.2s ease;    }
    
    .note-card.trash-note:hover {      opacity: 1;    }
    
    /* å›æ”¶ç«™æ—¶é—´æ˜¾ç¤ºæ ·å¼ */
    .note-time.trash-time {      color: #b91c1c;      font-style: italic;    }
    
    .search-input,
    .note-input{
      width:100%; background:var(--bg); border:1px solid var(--border);
      border-radius:var(--radius); padding:8px 10px; font:inherit; outline:none;
      box-shadow:var(--shadow-sm); transition:border-color .15s ease, box-shadow .15s ease;
      color:var(--text);
    }
    .search-input::placeholder,
    .note-input::placeholder{ color:var(--muted); }
    .search-input:focus,.note-input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px var(--primary-weak); }
    .note-input{ padding:10px 72px 10px 10px; min-height:56px; max-height:120px; resize:vertical; }

    .add-note-wrapper{ position:relative; }
    .add-note-btn{
      position:absolute; right:4px; bottom:4px; padding:6px 10px;
      background:var(--bg); border:1px solid var(--border); border-radius:6px; font-size:13px; cursor:pointer;
      transition:background-color .15s ease, border-color .15s ease, transform .1s ease; box-shadow:var(--shadow-sm);
    }
    .add-note-btn:hover{ background:var(--bg); border-color:var(--primary); }
    .add-note-btn:active{ transform:translateY(1px); }
    .add-note-btn:disabled{ opacity:.5; cursor:not-allowed; }

    .image-preview-container-input{
      position:relative; margin-top:8px; border-radius:6px; overflow:hidden; border:1px dashed var(--border); background:var(--bg);
      padding:8px;
    }
    .image-preview-input{ width:100%; display:block; max-height:280px; object-fit:contain; }
    .remove-image-btn{
      position:absolute; top:8px; right:8px; width:22px; height:22px;
      background:var(--bg); border:1px solid var(--border); border-radius:50%; color:var(--error);
      font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center; line-height:1; box-shadow:var(--shadow-sm);
      z-index:10;
    }

    /* å›¾ç‰‡é¢„è§ˆç½‘æ ¼æ ·å¼ */
    .image-preview-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
      gap:8px;
      max-height:300px;
      overflow-y:auto;
    }
    .image-preview-grid img{
      width:100%;
      height:100px;
      object-fit:cover;
      border-radius:4px;
      border:1px solid var(--border);
    }

    /* ç¬”è®°å¡ç‰‡å›¾ç‰‡ç½‘æ ¼æ ·å¼ */
    .note-image-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(100px, 1fr));
      gap:6px;
      margin-top:6px;
    }
    .note-image-grid img{
      width:100%;
      height:100px;
      object-fit:cover;
      border-radius:4px;
    }

    .notes-list{
      flex:1 1 auto; min-height:0; overflow:auto;
      padding:12px; display:flex; flex-direction:column; gap:10px; background:var(--bg-muted);
    }

    /* @å¼•ç”¨èœå•ç‰¹å®šæ ·å¼ */
    .mention-menu{
      width:320px;
    }
    
    .mention-menu-header > div {
      font-size:12px;
      color:var(--muted);
      margin-bottom:4px;
    }
    
    .mention-menu-item{
      display:flex;
      align-items:flex-start;
      gap:8px;
      border-bottom:1px solid #f3f4f6;
    }
    
    .mention-menu-item:last-child {
      border-bottom:none;
    }
    
    .mention-menu-item-icon{
      font-size:16px;
      margin-top:1px;
    }
    
    .mention-menu-item-content{
      flex:1;
    }
    
    .mention-menu-item-title{
      font-weight:500;
      margin-bottom:2px;
    }
    
    .mention-menu-item-preview{
      font-size:11px;
      color:var(--muted);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    
    /* å¤šå›¾ç½‘æ ¼å¸ƒå±€ - ä¿ç•™å¼•ç”¨å¼¹çª—ç‰¹æœ‰çš„å›¾ç‰‡æ ·å¼ */
    .mention-popover-images-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .mention-popover-images-grid .mention-popover-image-container {
      margin-top: 0;
    }

    .mention-popover-images-grid .mention-popover-image {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }
    
    .mention-menu-item-time{
      font-size:10px;
      color:#9ca3af;
      margin-top:2px;
    }
    
    /* å¼•ç”¨å¼¹çª—å›¾ç‰‡å®¹å™¨æ ·å¼ - ä¿ç•™ç‰¹æœ‰çš„å›¾ç‰‡æ ·å¼ */
    .mention-popover-image-container {
      margin-top: 8px;
    }
    
    .mention-popover-image {
      max-width: 100%;
      height: auto;
      border-radius: 4px;
    }
    
    /* å¼•ç”¨å¼¹çª—å†…å®¹æ ·å¼ - ä¿ç•™ç‰¹æœ‰çš„å†…å®¹æ ·å¼ */
    .mention-popover-content-item {
      padding: 8px 0;
    }
    
    .mention-popover-text {
      margin: 0 0 8px 0;
      word-wrap: break-word;
      line-height: 1.4;
    }
    
    .mention-popover-meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    
    /* @å¼•ç”¨æ ‡ç­¾æ ·å¼ */
    .mention-tag{
      background:#e0f2fe;
      color:#0ea5e9;
      padding:2px 6px;
      border-radius:4px;
      font-weight:500;
      cursor:pointer;
      text-decoration:none;
      margin:0 2px;
      font-size:12px;
      transition: background-color 0.2s ease;
    }
    
    .mention-tag:hover{
      background:#bae6fd;
    }

    .note-card{
      background:var(--bg); border:1px solid var(--border);
      border-radius:var(--radius); padding:12px; box-shadow:var(--shadow-sm);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .note-card:hover{ box-shadow:var(--shadow-md); transform:translateY(-1px); }
    .menu-open .note-card:hover{ box-shadow:none; transform:none; }

    .note-card.archived{ background:#f9fafb; }
    .archived-text{ color:#d1d5db; }

    .note-content{ margin-bottom:6px; word-break:break-word; line-height:1.6; font-size:12px; }
    .note-image{ max-width:100%; height:auto; border-radius:4px; cursor:pointer; transition:opacity .15s ease; }
    .note-image:hover{ opacity:.9; }
    .note-header { position: relative; display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 6px; }
    
    .note-time{ font-size:10px; color:#9ca3af; }
    
    .note-source { display: flex; align-items: center; gap: 4px; font-size: 10px; color: #6b7280; background: #f3f4f6; padding: 2px 6px; border-radius: 4px; line-height: 1.4; }
    
    .source-favicon { width: 12px; height: 12px; margin-right: 4px; object-fit: contain; }
    
    .source-domain, .source-title { color: #6b7280; text-decoration: none; }
    
    .source-domain:hover, .source-title:hover { text-decoration: underline; color: #3b82f6; }
    
    .source-external { margin-left: 2px; font-size: 11px; opacity: 0.7; }
    
    .source-copy-btn { background: transparent; border: none; cursor: pointer; padding: 0 2px; margin-left: 4px; font-size: 10px; opacity: 0.7; transition: opacity 0.2s; }
    
    .source-copy-btn:hover { opacity: 1; }
    
    .note-tag{ 
      background:#eef3fe; 
      color:#7193d0; 
      padding:2px 6px; 
      border-radius:4px; 
      font-weight:500; 
      cursor:pointer; 
      text-decoration:none; 
      margin:0 2px;
      font-size:12px; 
      transition: background-color 0.2s ease;
    }
    .note-tag:hover{
      background:var(--primary-weak);
    }

    .card-actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top:6px;
    }
    
    .tags-container{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }
    
    .note-input-wrapper {
      position: relative;
    }

    .tag-btn{
      display: none;
      width: 24px;
      height: 24px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
    }

    .tag-btn:hover {      background: var(--bg);      border-color: var(--primary);    }

    .mention-btn{
      display: none;
      width: 24px;
      height: 24px;
      background: #3B82F6;
      border: 1px solid #2563EB;
      border-radius: 4px;
      font-size: 14px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
      margin-left: 4px;
    }

    .mention-btn:hover {
      background: #2563EB;
      border-color: #1D4ED8;
    }

    .add-note-btn{
      position:absolute; right:4px; bottom:4px; padding:6px 10px;
      background:var(--bg); border:1px solid var(--border); border-radius:6px; font-size:13px; cursor:pointer;
      transition:background-color .15s ease, border-color .15s ease, transform .1s ease; box-shadow:var(--shadow-sm);
      z-index: 5;
    }

    .more-menu-container{ position:relative; display:flex; justify-content:flex-end; }

    /* é€šç”¨ä¸‹æ‹‰èœå•æ ·å¼ */
    .dropdown-menu{
      position:absolute;
      top:100%;
      left:0;
      max-height:300px;
      background:var(--bg);
      border:1px solid var(--border);
      border-radius:8px;
      box-shadow:var(--shadow-md);
      z-index:100;
      overflow:hidden;
      display:none;
    }
    
    .dropdown-menu-header{
      padding:8px 12px;
      border-bottom:1px solid var(--border);
      background:var(--bg-muted);
    }
    
    .dropdown-menu-search{
      width:100%;
      padding:6px 8px;
      border:1px solid var(--border);
      border-radius:4px;
      font-size:12px;
    }
    
    .dropdown-menu-list{
      max-height:250px;
      overflow-y:auto;
    }
    
    .dropdown-menu-item{
      padding:8px 12px;
      cursor:pointer;
      font-size:13px;
      transition: background-color 0.2s ease;
    }
    
    .dropdown-menu-item:hover{
      background:var(--bg-muted);
    }
    
    /* æ ‡ç­¾èœå•ç‰¹å®šæ ·å¼ */
    .tag-menu{
      width:280px;
    }
    
    /* @å¼•ç”¨èœå•ç‰¹å®šæ ·å¼ */
    .mention-menu{
      width:280px;
    }
    
    .tag-menu-item{
      padding:8px 12px;
      cursor:pointer;
      font-size:11px;
      display:flex;
      align-items:center;
      gap:8px;
      transition: background-color 0.2s ease;
    }
    
    .tag-menu-item:hover{
      background:var(--bg-muted);
    }
    
    .tag-menu-item-tag{
      background:#3B82F6;
      color:#fff;
      padding:2px 6px;
      border-radius:4px;
      font-size:11px;
    }
    .more-btn{
      width:22px; height:22px; padding:0; background:transparent; border:1px solid var(--border);
      border-radius:4px; font-size:14px; font-weight:bold; cursor:pointer; display:flex; align-items:center; justify-content:center; opacity:0;
      transition:opacity .15s ease, background-color .15s ease, border-color .15s ease;
    }
    .note-card:hover .more-btn{ opacity:1; }
    .more-btn:hover{ background:#f9fafb; border-color:var(--primary); }
    .drop-menu{
      position:absolute; top:100%; right:0; margin-top:4px; background:var(--bg);
      border:1px solid var(--border); border-radius:6px; box-shadow:0 2px 8px rgba(0,0,0,.15); min-width:110px; z-index:100; overflow:hidden;
    }
    .menu-option{ padding:8px 10px; cursor:pointer; font-size:14px; }
    .menu-option:hover{ background:#f9fafb; }
    .menu-option.delete{ color:var(--error); }

    .empty-state{ text-align:center; padding:28px 16px; color:var(--muted); font-size:13px; }

    .fullscreen-preview{ position:fixed; inset:0; background:rgba(0,0,0,.9); display:flex; align-items:center; justify-content:center; z-index:3000; cursor:pointer; }
    .fullscreen-image{ max-width:90%; max-height:90vh; object-fit:contain; }

    .rail{
      display:flex; flex-direction:column; gap:3px; padding:6px 3px;
      background:rgb(255, 255, 255); border-radius:10px; margin:12px 6px 12px 0;
    }
    .railbtn{
      width:32px; height:32px; border:none; background:transparent; border-radius:6px;
      font-size:16px; cursor:pointer; display:flex; align-items:center; justify-content:center;
      transition:background-color .15s ease, transform .1s ease;
    }
    .railbtn:hover{ background:var(--bg); }
    .railbtn:active{ transform:translateY(1px); }
    .railbtn.active{ background:var(--primary-weak); color:var(--primary); }

    *{ scrollbar-width:thin; scrollbar-color:#CBD5E1 transparent; }
    *::-webkit-scrollbar{ width:8px; height:8px; }
    *::-webkit-scrollbar-thumb{ background:#CBD5E1; border-radius:8px; }
    *::-webkit-scrollbar-thumb:hover{ background:#94A3B8; }
    *::-webkit-scrollbar-track{ background:transparent; }

  /* AIæ´å¯Ÿå¼¹çª—æ ·å¼ */
  .ai-insight-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 20px;
  }
  
  /* ç¬”è®°å¡ç‰‡å¼¹çª—æ ·å¼ - ç¡®ä¿åœ¨æœ€é¡¶å±‚ */
  #mention-popover {
    z-index: 2100;
  }
  
  .ai-insight-modal-content {
    background: var(--bg);
    border-radius: var(--radius);
    width: 100%;
    max-width: 600px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }
  
  .ai-insight-modal-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .ai-insight-modal-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text);
  }
  
  .ai-insight-close-btn {
    background: none;
    border: none;
    font-size: 24px;
    color: var(--muted);
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
  }
  
  .ai-insight-close-btn:hover {
    background: var(--bg-muted);
    color: var(--text);
  }
  
  .ai-insight-modal-body {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
  }
  
  .ai-insight-loading {
    text-align: center;
    padding: 40px 20px;
  }
  
  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border);
    border-top: 3px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 16px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .ai-insight-content {
    line-height: 1.7;
    color: var(--text);
  }
  
  .ai-insight-content p {
    margin-bottom: 16px;
  }
  
  .ai-insight-content p:last-child {
    margin-bottom: 0;
  }
  
  /* å…³è”æŠ¥å‘Šæ ·å¼ */
  .relate-report {
    font-size: 14px;
    line-height: 1.6;
    color: var(--text);
  }
  
  .relate-report .report-paragraph {
    margin: 0 0 16px 0;
    padding: 0;
  }
  
  .relate-report .report-paragraph:last-child {
    margin-bottom: 0;
  }
  
  .relate-report a {
    color: var(--primary);
    text-decoration: none;
  }
  
  .relate-report a:hover {
    text-decoration: underline;
  }
  
  .error-message {
    color: var(--danger);
    background-color: rgba(239, 68, 68, 0.1);
    padding: 16px;
    border-radius: 8px;
    border: 1px solid var(--danger);
    text-align: center;
    font-weight: 500;
  }
  </style>
</head>
<body>
  <div class="container">
      <div class="content-wrapper">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
          <div class="header-top">
            <h2>ç¬”è®°</h2>
            <div class="header-controls">
              <!-- é¢æ¿åˆ‡æ¢ä¸‹æ‹‰èœå• -->
              <div class="dropdown">
                <button id="panelSwitchBtn" class="dropdown-btn">
                  <span class="dropdown-arrow">â–¼</span>
                </button>
                <div id="panelDropdown" class="dropdown-content">
                  <a href="#" data-target="pha-panel" class="dropdown-item">ğŸ‘ï¸ PHA</a>
                  <a href="#" data-target="rocket-panel" class="dropdown-item">ğŸš€ RKT</a>
                  <a href="#" data-target="notes-panel" class="dropdown-item active">ğŸ“ NOTE</a>
                  <a href="#" data-target="todo-panel" class="dropdown-item">ğŸ“‹ TODO</a>
                  <a href="#" data-target="gerrit-panel" class="dropdown-item">ğŸ” GERRIT</a>
                  <a href="#" data-target="settings-panel" class="dropdown-item">âš™ï¸ SETTINGS</a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-section">
          <div class="search-container">
            <div class="search-header">
              <button id="search-button" class="search-button">ğŸ”</button>
              <button id="trash-button" class="trash-button" title="å›æ”¶ç«™">ğŸ—‘ï¸</button>
              <button id="ai-button" class="ai-button" title="AIåŠ©æ‰‹">ğŸ¤–</button>
            </div>
            <input type="text" id="search-input" class="search-input" placeholder="æœç´¢ç¬”è®°..." style="margin-top:4px;"/>
          </div>

          <div class="note-input-wrapper">
            <div class="add-note-wrapper">
              <textarea id="note-input" class="note-input" placeholder="è®°ç‚¹å•¥â€¦" rows="1"></textarea>
              <button id="tag-btn" class="tag-btn" title="æ·»åŠ æ ‡ç­¾">#</button>
              <button id="mention-btn" class="mention-btn" title="å¼•ç”¨ç¬”è®°">@</button>
              <button id="add-note-btn" class="add-note-btn" style="display:none">æ·»åŠ </button>
            </div>
            
            <!-- AIåŠŸèƒ½è¾“å…¥åŒº -->
            <div id="ai-input-container" class="ai-input-container" style="display:none;">
              <div class="ai-tag-selection">
                <label for="ai-tag-input">é€‰æ‹©æ ‡ç­¾ï¼š</label>
                <input type="text" id="ai-tag-input" class="ai-tag-input" placeholder="è¾“å…¥æˆ–é€‰æ‹©æ ‡ç­¾..." />
              </div>
              <div class="ai-prompt-input-wrapper">
                <label for="ai-prompt-input">è¾“å…¥Promptï¼š</label>
                <textarea id="ai-prompt-input" class="ai-prompt-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–éœ€æ±‚..." rows="3"></textarea>
                <button id="ai-submit-btn" class="ai-submit-btn">å‘é€</button>
              </div>
            </div>
            
            <!-- æ ‡ç­¾èœå• -->
            <div id="tag-menu" class="dropdown-menu tag-menu">
              <div class="dropdown-menu-header tag-menu-header">
                <input type="text" id="tag-menu-search" class="dropdown-menu-search tag-menu-search" placeholder="æœç´¢æ ‡ç­¾..."/>
              </div>
              <div id="tag-menu-list" class="dropdown-menu-list tag-menu-list">
                <!-- æ ‡ç­¾åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>

            <!-- @å¼•ç”¨èœå• -->
            <div id="mention-menu" class="dropdown-menu mention-menu">
              <div class="dropdown-menu-header mention-menu-header">
                <input type="text" id="mention-menu-search" class="dropdown-menu-search mention-menu-search" placeholder="æœç´¢ç¬”è®°..."/>
              </div>
              <div id="mention-menu-list" class="dropdown-menu-list mention-menu-list">
                <!-- ç¬”è®°åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
              </div>
            </div>

            <div id="image-preview-container" class="image-preview-container-input" style="display:none;">
              <!-- å›¾ç‰‡é¢„è§ˆå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>
        </div>

        <div id="notes-container" class="notes-list"></div>

        <div id="empty-state" class="empty-state" style="display:none;">
          æ— å†…å®¹ã€‚è¾“å…¥æˆ–ç²˜è´´å›¾ç‰‡å³å¯ã€‚
        </div>
      </div>
    </div>

  <div id="fullscreen-preview" class="fullscreen-preview" style="display:none;">
    <img id="fullscreen-image" class="fullscreen-image" src="" alt="é¢„è§ˆ"/>
  </div>

  <!-- @å¼•ç”¨å¼¹çª— -->
  <div id="mention-popover" class="ai-insight-modal" style="display:none;">
    <div class="ai-insight-modal-content">
      <div class="ai-insight-modal-header">
        <h3>å¼•ç”¨å†…å®¹</h3>
        <button id="mention-popover-close" class="ai-insight-close-btn">&times;</button>
      </div>
      <div class="ai-insight-modal-body">
        <div class="mention-popover-meta" id="mention-popover-meta"></div>
        <div id="mention-popover-content" class="mention-popover-content"></div>
      </div>
    </div>
  </div>

  <!-- AIæ´å¯Ÿå¼¹çª— -->
  <div id="ai-insight-modal" class="ai-insight-modal" style="display:none;">
    <div class="ai-insight-modal-content">
      <div class="ai-insight-modal-header">
        <h3>AIæ´å¯Ÿ</h3>
        <button id="close-ai-insight-modal" class="ai-insight-close-btn">&times;</button>
      </div>
      <div class="ai-insight-modal-body">
        <div id="ai-insight-loading" class="ai-insight-loading" style="display:block;">
          <div class="loading-spinner"></div>
          <p>æ­£åœ¨ç”Ÿæˆæ´å¯ŸæŠ¥å‘Š...</p>
        </div>
        <div id="ai-insight-content" class="ai-insight-content" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- å…³è”æŠ¥å‘Šå¼¹çª— -->
  <div id="relate-report-modal" class="ai-insight-modal" style="display:none;">
    <div class="ai-insight-modal-content">
      <div class="ai-insight-modal-header">
        <h3>å…³è”æŠ¥å‘Š</h3>
        <button id="close-relate-report-modal" class="ai-insight-close-btn">&times;</button>
      </div>
      <div class="ai-insight-modal-body">
        <div id="relate-report-loading" class="ai-insight-loading" style="display:block;">
          <div class="loading-spinner"></div>
          <p>æ­£åœ¨ç”Ÿæˆå…³è”æŠ¥å‘Š...</p>
        </div>
        <div id="relate-report-content" class="ai-insight-content" style="display:none;"></div>
      </div>
    </div>
  </div>

  <script type="module" src="../persist-init.js"></script>
  <script src="panel.js"></script>
</body>
</html>
